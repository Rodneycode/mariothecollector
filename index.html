<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript">
		  
		  window.fbAsyncInit = function() {
		    FB.init({
		      appId      : '337599526622883',
		      xfbml      : true,
		      version    : 'v2.8'
		    });
		    FB.AppEvents.logPageView();
		  };

		  (function(d, s, id){
		     var js, fjs = d.getElementsByTagName(s)[0];
		     if (d.getElementById(id)) {return;}
		     js = d.createElement(s); js.id = id;
		     js.src = "//connect.facebook.net/en_US/sdk.js";
		     fjs.parentNode.insertBefore(js, fjs);
		   }(document, 'script', 'facebook-jssdk'));
			
		</script>
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script type="text/javascript">

			var c,ctx;
			var marioSpeed = 10;
			var enemySpeed = 12;
			var runEnemyBotTrigger = 1;
			var runMarioBotTrigger = 0;
			var cointt = 1;
			var cwidth = 900;
			var cheight = 600;
			var coinRemainingOriginal = 4;
			var coinRemaining = 0;
			var coinLimits = 4;
			var coinActors = [];
			var level = 1;
			var score = 0;
			var appendedScore = 0;
			var timeLimit = 60;
			var timeLimitOriginal = timeLimit;
			var timeLimitInterval = 0;
			var gameOver = 0;
			var timerCalled = 0;
			var keyEvents = {
				screenx: 0,
				screeny: 0,
				screenxx: 0,
				screenyy: 0,
				mousedown: false,
				keydown: true,
				left: false,
				right: false,
				up: false,
				down: false,
				leftlast: false,
				rightlast: false,
				uplast: false,
				downlast: false
			};

			function init(){
				c = document.getElementById('main-screen');
				ctx = c.getContext('2d');
				ctx.textBaseline = "middle";
		        ctx.font = "400 24px arial";
		        ctx.fillStyle = "white";
			}

			var World = {
				sizex: 1500,
				sizey: 600
			}

			var Game = {
				offsetMaxX: World.sizex - cwidth,
				offsetMaxY: World.sizey - cheight,
				offsetMinX: 0,
				offsetMinY: 0
			}

			/*
			var coinAudio = document.createElement('audio');
			coinAudio.controls = true;
			coinAudio.src = 'audio/coinSoundSample.mp3';
			coinAudio.loop = '';
	
			*/

			var camera = function(){
				this.x = 0;
				this.y = 0;
			}

			var customCamera = function(){
				this.x = 0;
				this.y = 0;
			}


			var stage = function(){
				this.controlled = 0;
				this.actors = [];
				this.camera = '';
				this.customCamera = '';
				this.followedActor = '';
				this.name ='default-stage';
				this.translateX = 0;
				this.translateY = 0;
				this.map = '';
				this.t = '';
				this.texts = [];
				this.scene = '';
				this.sInterval = 0;
				this.inits = '';
				this.switchx = 0;
				this.switchy = 1;
				this.setScene = function(sceneGet,initsGet){
					this.scene = sceneGet;
					initsGet();
					this.render(sceneGet);
				}

				
				this.addText = function(textGet){
					if(textGet!=''){
						this.texts[textGet.name] = textGet;
					}
						
				}
				this.clear = function(){

					//clear all drawings to free memory
					//ctx.clearRect(0,0,cwidth,cheight);
					
					if(this.actors!=[]){
						for(var x in this.actors){
							delete this.actors[x];
						}	
					}
					if(this.texts!=[]){
						for(var x in this.texts){
							delete this.texts[x];
						}						
					}
					
					//clear interval
					clearInterval(this.t);

					
				}
				this.addTileMap = function(tileMapArray,destx,desty,w,h){
					
					this.map = tileMapArray;
					var getdestx = destx;
					var getdesty =desty;
					var getw = w;
					var geth = h;
					var limitTilesX = w/this.map.w;
					var limitTilesY = h/this.map.h;

					if(this.map!=''){

						for(var b=0;b<this.map.data.length;b++){
							for(var a=0;a<this.map.data[b].length;a++){
								var tileSprite = new sprite();
								var tileActor = new actor();
								var setY = 0;
								var setX = (this.map.data[b][a]-1)*this.map.w;
								if(limitTilesX<this.map.data[b][a]){
									setY = (this.map.data[b][a]%limitTilesX==0) ? (this.map.data[b][a]/limitTilesX) : Math.ceil(this.map.data[b][a]/limitTilesX);
									setX = (this.map.data[b][a]%limitTilesX -1)*this.map.w;
									setY = (setY - 1)*this.map.h;

								}

								
								tileSprite.init({
									resource: this.map.resource,
									srcx: setX,
									srcy: setY,
									h: this.map.h,
									w: this.map.w
								});
								
								tileActor.init({
									sprite: tileSprite,
									x: destx,
									y: desty,
									h: this.map.h,
									w: this.map.w,
									name: 'tile-'+a+'-'+b
								});

								this.actors[tileActor.name] = tileActor;
								//this.actors[tileActor.name] = tileActor;
								destx = destx + this.map.w;
							}
							destx = getdestx;
							desty = desty + this.map.h;
						}
					}
					
				}
				this.remove = function(actorName){
					delete this.actors[actorName];
				}
				this.setCustomCamera = function(cameraGet){
					this.customCamera = cameraGet;
				}

				this.setCamera = function(cameraGet){
					this.camera = cameraGet;

				}
				this.addActor = function(actorGet){
					//this.actors.push(actorGet);
					//var dynamicActor[actorGet.name] = actorGet;
					this.actors[actorGet.name] = actorGet;
				}

				this.follow = function(actorGet){
					this.followedActor = actorGet;
				}

				this.render = function(cback){
					
					var thisHere = this;

					this.t =setInterval(function(){

						
						//clear all drawings to free memory
						
						ctx.clearRect(0,0,cwidth,cheight);
						
						for(var x in thisHere.actors){
							//console.log(x);
							if(thisHere.camera!=''){
								
								if(x==thisHere.followedActor.name){

									thisHere.camera.x = thisHere.actors[x].x - cwidth / 2;
									thisHere.camera.y = thisHere.actors[x].y - cheight / 2;

								}

								if(thisHere.camera.x > Game.offsetMaxX)
								    thisHere.camera.x = Game.offsetMaxX;
								else if(thisHere.camera.x<Game.offsetMinX)
								    thisHere.camera.x = Game.offsetMinX;

									
								if(thisHere.camera.y > Game.offsetMaxY)
								    thisHere.camera.y = Game.offsetMaxY;
								else if(thisHere.camera.y<Game.offsetMinY)
								    thisHere.camera.y = Game.offsetMinY;
									

								thisHere.translateX = thisHere.actors[x].x-thisHere.camera.x;
								thisHere.translateY = thisHere.actors[x].y-thisHere.camera.y; 

							}else{

								thisHere.translateX = thisHere.actors[x].x;
								thisHere.translateY = thisHere.actors[x].y;	
								
							}

							if(thisHere.actors[x].stay==1){
								ctx.drawImage(thisHere.actors[x].sprite.resource,thisHere.actors[x].sprite.srcx,thisHere.actors[x].sprite.srcy,thisHere.actors[x].sprite.w,thisHere.actors[x].sprite.h,thisHere.actors[x].x,thisHere.actors[x].y,thisHere.actors[x].w,thisHere.actors[x].h);

							}else{

								ctx.drawImage(thisHere.actors[x].sprite.resource,thisHere.actors[x].sprite.srcx,thisHere.actors[x].sprite.srcy,thisHere.actors[x].sprite.w,thisHere.actors[x].sprite.h,thisHere.translateX,thisHere.translateY,thisHere.actors[x].w,thisHere.actors[x].h);	
								
								//ctx.drawImage(thisHere.actors[x].sprite.resource,thisHere.actors[x].sprite.srcx,thisHere.actors[x].sprite.srcy,thisHere.actors[x].sprite.w,thisHere.actors[x].sprite.h,thisHere.actors[x].x,thisHere.actors[x].y,thisHere.actors[x].w,thisHere.actors[x].h);
							}
							
						}


						if(thisHere.texts!=[]){

							for(var x in thisHere.texts){
								//fillStyle: 'white'
								
								if(timeLimit<=10){
									var fillStyle= (thisHere.texts[x].name=='timer-name') ? 'red' : 'white';						
									ctx.fillStyle = fillStyle;
								}

								ctx.fillStyle = thisHere.texts[x].fillStyle;
								ctx.font = (thisHere.texts[x].font) ? thisHere.texts[x].font : "400 24px arial";
								
								ctx.fillText(thisHere.texts[x].value,thisHere.texts[x].x,thisHere.texts[x].y);		
							}
							
						}
							
						//ctx.fillText(this.dynamicText,this.sprites[x].x+3,this.sprites[x].y-10);
						if(cback)
							cback();
					},100);
					
					
					
				}

			}


			var enemyAnimation = {
				walk_down: [1,2,3],
				walk_left: [1,2,3],
				walk_right: [1,2,3],
				walk_up: [1,2,3]
			};


			var marioAnimation = {
				walk_down: [1,2,3],
				walk_left: [4,5,6],
				walk_right: [1,2,3,4],
				walk_up: [1,2,3]
			};


			var coinAnimation = {
				normal: [1,2,3,4,5,6,7,8,9,10]
			};

			var actor = function(){
				this.stay = 0;
				this.x = 0;
				this.y = 0;
				this.h =  100;
				this.w = 100;
				this.tt = 0;
				this.sprite = '';
				this.animationX = 0;
				this.staticFrameX = 0;
				this.staticFrameY = 0;
				this.name = '';
				this.setOnClickListener = function(cb,minusx,minusy){
					
					if(keyEvents.mousedown==true){
						
						var translateX = keyEvents.screenx-minusx;
						var translateY = keyEvents.screeny-minusy;


						if(translateX>=this.x && translateX<=(this.x+this.w) && translateY>=this.y && translateY<=(this.y+this.h)){
							cb();
						}
						/*
						if((keyEvents.screenx-8)>=this.x && (keyEvents.screenx-8)<=(this.x+this.w) && (keyEvents.screeny-8)>=this.y && (keyEvents.screeny-8)<=(this.y+this.h)){
							cb();
							
						}*/	
					}
					
				}


				this.init = function(config){
					for (var x in config){
						this[x] = config[x];
					}
				}
				this.stopAnimation = function(){

					if(keyEvents.keydown==false){
						//console.log(this.sprite);
						this.sprite.srcx = (this.staticFrameX - 1) * this.w;
						this.sprite.srcy = (this.staticFrameY - 1) * this.h;		
					}
				}
				this.playAnimation = function(action,animationResource,staticFrameGetX,staticFrameGetY){

					this.staticFrameX = staticFrameGetX;
					this.staticFrameY = staticFrameGetY;
					this.sprite.srcy = (this.staticFrameY - 1) * this.h;
					if(this.animationX<animationResource[action].length){

						this.sprite.srcx = (animationResource[action][this.animationX] - 1) * this.w;

						this.animationX++;
					}else{
						this.animationX = 0;
					}
					
					
					
					//this.sprite.srcx
				}
				this.collide = function(actorGet){

					var collided = 0;
					if((this.x>=actorGet.x && this.x<=(actorGet.x+actorGet.w)) && (this.y>=actorGet.y && this.y<=(actorGet.y+actorGet.h))){
						collided = 1;
					}

					if(((this.x+this.w)>=actorGet.x && (this.x+this.w)<=(actorGet.x+actorGet.w)) && (this.y>=actorGet.y && this.y<=(actorGet.y+actorGet.h))){
						collided = 1;
					}


					if((this.x>=actorGet.x && this.x<=(actorGet.x+actorGet.w)) && ((this.y+this.h)>=actorGet.y && (this.y+this.h)<=(actorGet.y+actorGet.h))){
						collided = 1;
					}




					if(collided==1)
						return true;
					else
						return false;
				}

			}

			var sprite = function(){
				this.resource = '';
				this.srcx = 0;
				this.srcy = 0;
				this.h = 100;
				this.w = 100;
				this.destx = 0;
				this.desty = 0;

				this.init = function(config){
					
					for(var x in config){
						this[x] = config[x];
					}

				}
			}

			function addCoinSprites(){

				for(var x=0;x<coinLimits;x++){
					coinSprites[x] = new sprite();
					coinSprites[x].init({
					resource: document.getElementById('coins'),
					srcx: 0,
					srcy: 0,
					destx: 0,
					desty: 0,
					h: 41,
					w: 44
					});	
				}

				var coinStartX = Math.floor((Math.random() * (World.sizex)) + 1);
				var coinStartY = Math.floor((Math.random() * (World.sizey)) + 1);


				if((coinStartX+44)>World.sizex){
					coinStartX-=44;
				}
				if(coinStartX<0){
					coinStartX+=44;
				}
				
				if((coinStartY+41)>World.sizey){
					coinStartY-=41;
				}

				if(coinStartY<0){
					coinStartY+=41;
				}

				var coinUsedX = [];
				var coinUsedY = [];

				
				for(var x=0;x<coinLimits;x++){


					(function repeat(){
						if(search(coinStartX,coinUsedX) && search(coinStartY,coinUsedY)){
							coinStartX = Math.floor((Math.random() * (World.sizex)) + 1);
							coinStartY = Math.floor((Math.random() * (World.sizey)) + 1);

							if((coinStartX+44)>World.sizex){
								coinStartX-=44;
							}
							if(coinStartX<0){
								coinStartX+=44;
							}
							
							if((coinStartY+41)>World.sizey){
								coinStartY-=41;
							}

							if(coinStartY<0){
								coinStartY+=41;
							}
							repeat();
						}else{
							coinUsedX.push(coinStartX);
							coinUsedY.push(coinStartY);

							var coinAdd = new actor();
							coinAdd.init({
								sprite: coinSprites[x],
								x: coinStartX,
								y: coinStartY,
								h: 41,
								w: 44,
								name: 'coin-'+x
							});
							
							st.addActor(coinAdd);
							coinActors.push(coinAdd);

							coinStartX = Math.floor((Math.random() * (World.sizex)) + 1);
							coinStartY = Math.floor((Math.random() * (World.sizey)) + 1);

							if((coinStartX+44)>World.sizex){
								coinStartX-=44;
							}
							if(coinStartX<0){
								coinStartX+=44;
							}
							
							if((coinStartY+41)>World.sizey){
								coinStartY-=41;
							}

							if(coinStartY<0){
								coinStartY+=41;
							}

						}
					})();

				}
			}

			function runTimer(stGet){

				if(timerCalled==0){
					timerCalled = 1;
					timeLimitInterval = setInterval(function(){
						if(timeLimit!=0){
							//stGet.texts['timer-name'].fillStyle = 'white';
							timeLimit--;
							//ctx.fillStyle = "white";
							//stGet.texts['timer-name'].fillStyle = 'red';
							stGet.texts['timer-name'].value = timeLimit;
						}else{
							gameOver = 1;
						}
						
					},1000);	
				}
				

			}

			function search(valueGet,arrayGet){

				var matches = 0;
				if(arrayGet.length>0){
					for(var x=0;x<arrayGet.length;x++){
						if(arrayGet[x]==valueGet){
							matches = 1;
						}
					}
				}

				if(matches==1)
					return true;
				else
					return false;
			}





			var cm = new camera();
			var st = new stage();
			var menust = new stage();
			var chimneySprite = new sprite();
			var marioSprite = new sprite();
			var enemySprite = new sprite();
			var marioIconSprite = new sprite();
			var coinSprites = [];
			var tileMap = '';
			window.addEventListener('load',function(){

				/* Facebook code starts here */
		
				
				FB.getLoginStatus(function(response) {
			    	if(response.status!='connected'){
			    		FB.login(function(response) {
						  if (response.status === 'connected') {
						    // Logged into your app and Facebook.
						  } else if (response.status === 'not_authorized') {
						    // The person is logged into Facebook, but not your app.
						  } else {
						    // The person is not logged into Facebook, so we're not sure if
						    // they are logged into this app or not.
						  }
						},{scope: 'public_profile,email,publish_actions'});		
			    	}else{
			    		 FB.logout(function(response){
			    		 	FB.login(function(response) {
							  if (response.status === 'connected') {
							    // Logged into your app and Facebook.
							  } else if (response.status === 'not_authorized') {
							    // The person is logged into Facebook, but not your app.
							  } else {
							    // The person is not logged into Facebook, so we're not sure if
							    // they are logged into this app or not.
							  }
							},{scope: 'public_profile,email,publish_actions'});
			    		 });
			    	}
			  	});
				
				/* Facebook code ends here */

				//initialize important components
				init();
				

				tileMap = {
					data: [[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],
						   [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]],
					resource: document.getElementById('tileMap'),
				//	h: 32,
				//	w: 31, 
					h: 48,
					w: 48
				};

			
				chimneySprite.init({
					resource: document.getElementById('chimney'),
					srcx: 0,
					srcy: 0,
					destx: 0,
					desty: 0,
					h: 152,
					w: 143
				});

				marioIconSprite.init({
					resource: document.getElementById('marioIcon'),
					srcx: 0,
					srcy: 0,
					destx: 0,
					desty: 0,
					h: 256,
					w: 256
				});

				enemySprite.init({
					resource: document.getElementById('enemy'),
					srcx: 0,
					srcy: 0,
					destx: 0,
					desty: 0,
					h: 48,
					w: 48
				});
				
				var enemyActor = new actor();
				
				enemyActor.init({
					sprite: enemySprite,
					x: 0,
					y: 0,
					h: 48,
					w: 48,
					name: 'enemy'
				});


				marioSprite.init({
					resource: document.getElementById('mario'),
					srcx: 0,
					srcy: 0,
					destx: 0,
					desty: 0,
					h: 44,
					w: 28
				});

				var marioIconActor = new actor();
				marioIconActor.init({
					sprite: marioIconSprite,
					x: 320,
					y: 20,
					h: 256,
					w: 256,
					stay: 1,
					name: 'mario-icon'
				});

				var marioActor = new actor();
				marioActor.init({
					sprite: marioSprite,
					x: 100,
					y: 100,
					h: 43,
					w: 28,
					name: 'mario'
				});			

				var marioSecondActor = new actor();
				marioSecondActor.init({
					sprite: marioSprite,
					x: 100,
					y: 200,
					h: 43,
					w: 28,
					name: 'mario-second'
				});


				var chimneySecondActor = new actor();
				chimneySecondActor.init({
					sprite: chimneySprite,
					x: 500,
					y: 300,
					h: 143,
					w: 152,
					name: 'chimney-second'
				});

				var buttonStartSprite = new sprite();
				var buttonCreditSprite = new sprite();
				var buttonShareSprite = new sprite();
				var buttonBackSprite = new sprite();


				buttonStartSprite.init({
					resource: document.getElementById('buttons'),
					srcx: 0,
					srcy: 0,
					destx: 0,
					desty: 0,
					h: 136,
					w: 637
				});
				
				buttonBackSprite.init({
					resource: document.getElementById('buttons'),
					srcx: 1937,
					srcy: 0,
					destx: 0,
					desty: 0,
					h: 136,
					w: 637
				});


				buttonCreditSprite.init({
					resource: document.getElementById('buttons'),
					srcx: 637,
					srcy: 0,
					destx: 0,
					desty: 0,
					h: 136,
					w: 637
				});

				buttonShareSprite.init({
					resource: document.getElementById('buttons'),
					srcx: 1275,
					srcy: 0,
					destx: 0,
					desty: 0,
					h: 136,
					w: 637
				});

				var buttonBackActor = new actor();
				buttonBackActor.init({
					sprite: buttonBackSprite,
					x: 150,
					y: 400,
					h: 136,
					w: 637,
					stay: 1,
					name: 'button-back'
				});


				var buttonShareActor = new actor();
				buttonShareActor.init({
					sprite: buttonShareSprite,
					x: 150,
					y: 250,
					h: 136,
					w: 637,
					stay: 1,
					name: 'button-share'
				});


				var buttonStartActor = new actor();
				buttonStartActor.init({
					sprite: buttonStartSprite,
					x: 150,
					y: 280,
					h: 136,
					w: 637,
					stay: 1,
					name: 'button-start'
				});


				var buttonCreditActor = new actor();
				buttonCreditActor.init({
					sprite: buttonCreditSprite,
					x: 150,
					y: 430,
					h: 136,
					w: 637,
					stay: 1,
					name: 'button-credit'
				});



				function initMenu(){
					st.addTileMap(tileMap,0,0,384,384);
					//st.addTileMap(tileMap,0,0,48,48);
					//st.addTileMap(tileMap,0,0,93,63);
					/* Added coin sprites */
					addCoinSprites();

					//add our main actor "Mario the Collector"
					st.addActor(marioActor);
					st.addActor(buttonStartActor);
					st.addActor(buttonCreditActor);
					st.addActor(marioIconActor);
					//st.setCustomCamera(new customCamera());
					st.setCamera(cm);
					st.actors['mario'].tt = 1;
					st.actors['mario'].y = 400;
					st.actors['mario'].x = 400;
					st.follow(marioActor);
					st.addText({name:'instruction-name',value: 'Controls: A-LEFT, W-UP, S-DOWN,D-RIGHT',x:10,y:580,fillStyle: 'black'});

				}


				function inits(){
					timerCalled = 0;
					//st.addTileMap(tileMap,0,0,93,63);
					//st.addTileMap(tileMap,0,0,48,48);
					st.addTileMap(tileMap,0,0,384,384);

					/* Added coin sprites */
					addCoinSprites();

					//st.addActor(enemyActor);
					//add our main actor "Mario the Collector"
					st.addActor(marioActor);
					

					//\runEnemyBot();


					st.actors['mario'].y = 100;
					st.actors['mario'].x = 100;


					coinRemaining = coinRemainingOriginal;

					st.addText({name: 'level-name',value: 'LEVEL 1',x: 10,y:20,fillStyle: 'white'});
					st.addText({name:'score-name',value: 'SCORE: 0',x:650,y:20,fillStyle: 'white'});

					st.addText({name: 'timer-name-title',value: 'Time Remaining: ',x:10,y:60,fillStyle: 'white'});

					st.addText({name:'timer-name',value: timeLimit,x:200,y:60,fillStyle: 'white'});

					st.addText({name:'coinremaining-name',value: 'Coin Remaining: '+coinRemaining,x:10,y:100});
					st.addText({name:'instruction-name',value: 'Controls: A-LEFT, W-UP, S-DOWN,D-RIGHT',x:10,y:580,fillStyle: 'black'});
					//st.addActor(chimneySecondActor);
					st.setCamera(cm);
					st.follow(marioActor);

					

				}

				var intervalLimit = 0;



				function initGameOver(){
					st.addTileMap(tileMap,0,0,384,384);
		       		//st.addTileMap(tileMap,0,0,93,63);
					/* Added coin sprites */
					//addCoinSprites();
					st.addText({name: 'game-over-name',value: 'GAME OVER',x: 100,y:100,fillStyle: 'white',font: '400 100px Segoe Print'});
					st.addText({name: 'game-over-score-name',value: 'Your score: ' +appendedScore,x:120,y:200,fillStyle: 'white'});
					st.addActor(buttonShareActor);
					st.addActor(buttonBackActor);
					appendedScore = 0;
				}

				function shareFacebookScore(){
					FB.ui(
					 {
					  method: 'share',
					  href: 'https://apps.facebook.com/337599526622883'
					}, function(response){});
				}


				function runEnemyBot(){

					
					if(runEnemyBotTrigger==0){
						var direction = ['','up','down','left','right'];
						var duration = [1000,1000,2000,3000,4000];
						var whatDirection,whatDuration;
						whatDirection = Math.floor((Math.random() * (direction.length)) + 1);
						whatDuration = Math.floor((Math.random() * (duration.length)) + 1);
						var counter = 0;

						var t = setInterval(function(){
							if(runEnemyBotTrigger==0){
								if(counter==0){

									
									if(direction[whatDirection]=='up'){
										st.actors['enemy'].playAnimation('walk_up',enemyAnimation,1,4);
										if(st.actors['enemy'].y>=0){
				     						st.actors['enemy'].y-=enemySpeed;	
				     					}

				     				
									}else if(direction[whatDirection]=='left'){
										st.actors['enemy'].playAnimation('walk_left',enemyAnimation,1,2);
										if(st.actors['enemy'].x>=0){
				     						st.actors['enemy'].x-=enemySpeed;
				     					}
										
									}else if(direction[whatDirection]=='right'){
										st.actors['enemy'].playAnimation('walk_right',enemyAnimation,1,3);

										if((st.actors['enemy'].x+st.actors['enemy'].w)<=World.sizex){
				     						st.actors['enemy'].x+=enemySpeed;	
				     					}
										
									}else if(direction[whatDirection]=='down'){
										st.actors['enemy'].playAnimation('walk_down',enemyAnimation,1,1);

										if((st.actors['enemy'].y+st.actors['enemy'].h)<=World.sizey){
				     						st.actors['enemy'].y+=enemySpeed;
				     					}
									}

									if(st.actors['enemy'].collide(st.actors['mario'])){
				     					gameOver = 1;
				     					st.actors['enemy'].x = 0;
				     					st.actors['enemy'].y = 0;
				     					
				     				}
								}else{
									runEnemyBot();
									clearInterval(t);

								}	
							}else{
								clearInterval(t);
							}
							
						},100);

						setTimeout(function(){
							counter = 1;
						},duration[whatDuration]);	
					}else{

						clearInterval(t);
					}
					

				}
				function runMarioBot(){

					if(runMarioBotTrigger==0){
						var direction = ['','up','down','left','right'];
						var duration = [1000,1000,2000,3000,4000];
						var whatDirection,whatDuration;
						whatDirection = Math.floor((Math.random() * (direction.length)) + 1);
						whatDuration = Math.floor((Math.random() * (duration.length)) + 1);
						var counter = 0;

						var t = setInterval(function(){
							if(runMarioBotTrigger==0){
								if(counter==0){
									if(direction[whatDirection]=='up'){

										st.actors['mario'].playAnimation('walk_up',marioAnimation,1,3.77);
										if(st.actors['mario'].y>=0){
				     						st.actors['mario'].y-=marioSpeed;	
				     					}
									}else if(direction[whatDirection]=='left'){
										st.actors['mario'].playAnimation('walk_left',marioAnimation,5,1);
										if(st.actors['mario'].x>=0){
				     						st.actors['mario'].x-=marioSpeed;
				     					}
										
									}else if(direction[whatDirection]=='right'){
										st.actors['mario'].playAnimation('walk_right',marioAnimation,1,2.89);

										if((st.actors['mario'].x+st.actors['mario'].w)<=World.sizex){
				     						st.actors['mario'].x+=marioSpeed;	
				     					}
										
									}else if(direction[whatDirection]=='down'){
										st.actors['mario'].playAnimation('walk_down',marioAnimation,1,1);

										if((st.actors['mario'].y+st.actors['mario'].h)<=World.sizey){
				     						st.actors['mario'].y+=marioSpeed;
				     					}
									}
								}else{
									runMarioBot();
									clearInterval(t);

								}	
							}else{
								clearInterval(t);
							}
							
						},100);

						setTimeout(function(){
							counter = 1;
						},duration[whatDuration]);	
					}else{

						clearInterval(t);
					}
					




				}


				function gameOverScene(){
					st.actors['button-share'].setOnClickListener(function(){
     					//shareFacebookScore();
     					//alert('SHARE....');
     				},8,75);

     				st.actors['button-back'].setOnClickListener(function(){
     					st.clear();

     					st.setScene(menuScene,initMenu);
     					runMarioBotTrigger = 0;
     					runEnemyBotTrigger = 1;
     					runMarioBot();
     					shareFacebookScore();
     					//alert('SHARE....');
     				},8,75);
				}
				function menuScene(){
					
					if(cointt%1==0){
						cointt = 1;
						for(var x=0;x<coinActors.length;x++){
							if(st.actors['coin-'+x])
								st.actors['coin-'+x].playAnimation('normal',coinAnimation,1,1);
						}
					}else{
						cointt++;
					}
					



					st.actors['button-start'].setOnClickListener(function(){
     					//console.log(kb);
     					st.clear();
     					cointt = 1;
     					runMarioBotTrigger = 1;
     					runEnemyBotTrigger = 0;
     					keyEvents.down = false;
     					keyEvents.up = false;
     					keyEvents.left = false;
     					keyEvents.right = false;
     					keyEvents.keydown = false;
						keyEvents.rightlast = false;
						keyEvents.leftlast = false;
						keyEvents.uplast = false;
						keyEvents.downlast = false;


						//addCoinSprites();

     					st.setScene(mainScene,inits);
     					
     				},8,75);



     				for(var x=0;x<coinActors.length;x++){
     					if(st.actors['coin-'+x] && st.actors['mario'].collide(st.actors['coin-'+x])){
     						//coinAudio.play();
     						st.remove('coin-'+x);

     					}	
 					}


				}


				function mainScene(){
					//set our non-collision tilemap
					if(gameOver==1){
						/*
						jQuery.get('ajax.php',{action: 'save_score',score: appendedScore,name: 'kenneth'},function(responseGet){
							console.log(responseGet);
						},'json');*/
						gameOver = 0;
						keyEvents.keydown = false;
						firstTime = 1;
						/*
						keyEvents.keydown=false;
						keyEvents.left = false;
						keyEvents.right = false;
						keyEvents.up = false;
						keyEvents.down = false;
						keyEvents.leftlast = false;
						keyEvents.rightlast = false;
						keyEvents.uplast = false;
						keyEvents.downlast = false;
						gameOver = 0;*/
						st.clear();

						
						FB.api('/me', function(response) {
							if(response!=''){
								jQuery.get('ajax.php',{action: 'save_score',score: appendedScore,name: response.id},function(responseGet){
									console.log(responseGet);
								},'json')
							}
						});


						FB.api('/me/feed', 'post', {message: 'Oh! I got a score of '+appendedScore+' in Mario the Collector Game! https://apps.facebook.com/337599526622883' + ' Please play this awesome game!'});
						
						coinLimits = 4;
						coinRemainingOriginal = 4;
						coinRemaining = coinRemainingOriginal;
						timerCalled = 1;
						//appendedScore = 0;
						score = 0;
						clearInterval(timeLimitInterval);
						timeLimitOriginal = 60;
						timeLimit = timeLimitOriginal;
						level = 1;
						
						//st.setScene(mainScene,inits);
						/*
						st.setScene(menuScene,initMenu);
						st.actors['mario'].x = 100;
						st.actors['mario'].y = 100;
						st.actors['mario'].tt = 1;
						*/
						//runMarioBotTrigger = 1;
						st.setScene(gameOverScene,initGameOver);
						runMarioBot();
						runEnemyBotTrigger = 1;
						enemySpeed = 12;
						cointt = 1;
						
					}else{
						runTimer(st);
						if(keyEvents.keydown==false){
							st.actors['mario'].tt = 1;
							st.actors['mario'].stopAnimation();

						}

						if(firstTime==0){
							keyEvents.keydown = true;
							st.actors['mario'].playAnimation('walk_right',marioAnimation,1,2.89);
							st.actors['mario'].x+=5;
							firstTime = 1;
							keyEvents.keydown = false;
						}

						if(keyEvents.keydown==true){
							//
							if(score==coinLimits){
								score = 0;
								level++;
								//enemySpeed+=1.5;

								if(level==5){

									st.addActor(enemyActor);
									runEnemyBotTrigger= 0;
									runEnemyBot();
										
								}
								
								timerCalled = 0;
								coinLimits++;
								coinRemainingOriginal = coinLimits;
								coinRemaining = coinRemainingOriginal;
								st.texts['coinremaining-name'].value = 'Coin Remaining: ' + coinRemaining;
								addCoinSprites();
								clearInterval(timeLimitInterval);
								//timeLimitOriginal-=5;
								timeLimit=timeLimitOriginal;
								st.texts['level-name'].value = 'LEVEL '+level;
								mainScene();
							}

							for(var x=0;x<coinActors.length;x++){
		     					if(st.actors['coin-'+x] && st.actors['mario'].collide(st.actors['coin-'+x])){
		     						//coinAudio.play();
		     						score++;
		     						appendedScore++;
		     						coinRemaining--;
		     						st.texts['coinremaining-name'].value = 'Coin Remaining: ' + coinRemaining;
		     						st.texts['score-name'].value = 'SCORE: '+appendedScore;
		     						st.remove('coin-'+x);

		     					}	
	     					}
	     					

	     					if(keyEvents.right==true){
	     						if(st.actors['mario'].tt%1==0){
	     							st.actors['mario'].tt = 1;
		     						st.actors['mario'].playAnimation('walk_right',marioAnimation,1,2.89);

		     						if((st.actors['mario'].x+st.actors['mario'].w)<=World.sizex){
		     							st.actors['mario'].x+=marioSpeed;	
		     						}
	     						}else{
	     							st.actors['mario'].tt++;
	     							
							    }
	     					}

	     					if(keyEvents.left==true){
	     						
	     						if(st.actors['mario'].tt%1==0){
	     							st.actors['mario'].tt=1;
	     							st.actors['mario'].playAnimation('walk_left',marioAnimation,5,1);
								    if(st.actors['mario'].x>=0){
		     							st.actors['mario'].x-=marioSpeed;
		     						}
	     						}else{
	     							st.actors['mario'].tt++;
	     								
	     						}
	     						
	     						
	     					}

	     					if(keyEvents.up==true){
	     						if(st.actors['mario'].tt%1==0){
	     							st.actors['mario'].tt = 1;
		     						st.actors['mario'].playAnimation('walk_up',marioAnimation,1,3.77);

		     						if(st.actors['mario'].y>=0){
		     							st.actors['mario'].y-=marioSpeed;	
		     						}
	     						}else{
	     							st.actors['mario'].tt++;
	     							

	     						}
							    
	     					}

	     					if(keyEvents.down==true){
	     						if(st.actors['mario'].tt%1==0){
	     							st.actors['mario'].tt = 1;
	     							st.actors['mario'].playAnimation('walk_down',marioAnimation,1,1);

		     						if((st.actors['mario'].y+st.actors['mario'].h)<=(World.sizey-5)){
			     						st.actors['mario'].y+=marioSpeed;
		     						}

		     						

	     						}else{
	     							st.actors['mario'].tt++;
	     						}
	     					}
						}
						if(cointt%1==0){
							cointt=1;
							for(var x=0;x<coinActors.length;x++){
								if(st.actors['coin-'+x])
									st.actors['coin-'+x].playAnimation('normal',coinAnimation,1,1);
							}
						}else{
							cointt++;
						}
					}
				}


				
				c.tabIndex = 0;
     			c.style.outline = 0;
     			c.addEventListener('mousedown',function(e){
     				keyEvents.mousedown = true;
     				keyEvents.screenx = e.screenX;
     				keyEvents.screeny = e.screenY;
     			});
     			c.addEventListener('mouseup',function(e){
     				keyEvents.mousedown = false;
     				keyEvents.screenx = e.screenX;
     				keyEvents.screeny = e.screenY;
     			});



     			c.addEventListener('keydown',function(e){
     				keyEvents.keydown = true;
					keyEvents.rightlast = false;
					keyEvents.leftlast = false;
					keyEvents.uplast = false;
					keyEvents.downlast = false;
     				switch(e.keyCode) {
					    case 68:
					    	//right
					    	if(keyEvents.left==false && keyEvents.down==false && keyEvents.up==false){
					    		keyEvents.right = true;
					    	}
					    	
					    	
					        break;
					    case 65:
					    	//left
					    	if(keyEvents.right==false && keyEvents.down==false && keyEvents.up==false){
					    		keyEvents.left = true;
					    	}
					    	break;
					    case 83:
					    	//down
					    	if(keyEvents.left==false && keyEvents.right==false && keyEvents.up==false){
					    		keyEvents.down = true;
					    	}
					    	
					    	break;
					    case 87:
					    	//up
					    	if(keyEvents.left==false && keyEvents.down==false && keyEvents.right==false){
					    		keyEvents.up = true;
					    	}
					    default:
					        
					}
					
				});
				c.addEventListener('keyup',function(e){
					keyEvents.keydown = false;
					keyEvents.rightlast = false;
					keyEvents.leftlast = false;
					keyEvents.uplast = false;
					keyEvents.downlast = false;

					switch(e.keyCode) {
					    case 68:
					    	//right
					    	keyEvents.rightlast = true;
					    	keyEvents.right = false;
					        break;
					    case 65:
					    	//left
					    	keyEvents.leftlast = true;
					    	keyEvents.left = false;
					    	break;
					    case 83:
					    	//down
					    	keyEvents.downlast = true;
					    	keyEvents.down = false;
					    	break;
					    case 87:
					    	//up
					    	keyEvents.uplast = true;
					    	keyEvents.up = false;
					    default:
					        
					}


					//st.actors['mario'].stopAnimation();
				});

				var firstTime = 0;
				st.setScene(menuScene,initMenu);

				//assuming mario is already initialized.
				runMarioBot();
			});

		</script>
	</head>
	<body>
		<img id="mario" src="images/mario2.png" height=100 width=100 style="display:none;" />
		<img id="enemy" src="images/character_sprites.png" height=100 width=100 style="display:none;" />
		<!--

		<img id="tileMap" src="images/map_sprites.png" height=100 width=100 style="display:none;" /> -->
		<img id="chimney" src="images/chimney.png" height=100 width=100 style="display:none;" />
		<img id="buttons" src="images/buttons.png" height=100 width=100 style="display:none;" />
		<img id="marioIcon" src="images/mario-icon.png" height=100 width=100 style="display:none;" />
		<img id="coins" src="images/coinsprite.png" height=100 width=100 style="display:none;" />
		<img id="tileMap" src="images/main_tiles.png" height=100 width=100 style="display:none;" />
		<canvas id="main-screen" height=600 width=900>
		</canvas>
	</body>
</html>